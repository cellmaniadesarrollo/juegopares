<div class="game-container">
  <!-- Si estÃ¡ cargando -->
  @if (loading) {
  <div class="loading-screen d-flex justify-content-center align-items-center vh-100">
    <div class="text-center">
      <div class="spinner-border text-light mb-3" role="status"></div>
      <p class="text-white">Cargando evento...</p>
    </div>
  </div>
  }

  <!-- Si hay error -->
  @if (error && !loading) {
  <div class="text-center mt-5">
    <div class="alert alert-danger d-inline-block">
      <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
    </div>
  </div>
  }
  <!-- ðŸŽ¥ Pantalla inicial con carrusel -->
  @if (!loading && !error && !playerRegistered && !gameState.isGameStarted) {
  <div class="intro-layout container-fluid py-4 text-center text-light">
    <div class="row align-items-center justify-content-center">

      <!-- ðŸŸ¥ Columna izquierda (banner) -->
      <div class="col-12 col-lg-3 mb-4 mb-lg-0 banner-col">
        <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/logo-teamcellmania.png" alt="Logo"
          class="banner-logo mb-3" />

  <!-- ðŸŽ¬ SimulaciÃ³n de carrusel de videos (izquierda) -->
  <div class="video-rotator" *ngIf="videoUrlsLeft.length > 0">
    <video
      #videoPlayerLeft
      [src]="videoUrlsLeft[currentVideoLeft]"
      autoplay
      muted
      playsinline
      (ended)="nextVideo('left')"
    ></video>
  </div>



        <!-- ðŸ”— Redes -->
        <div class="social-icons mt-3 d-flex justify-content-center gap-3">
          <a href="https://facebook.com" target="_blank"><i class="bi bi-facebook"></i></a>
          <a href="https://instagram.com" target="_blank"><i class="bi bi-instagram"></i></a>
          <a href="https://tiktok.com" target="_blank"><i class="bi bi-tiktok"></i></a>
          <a href="https://youtube.com" target="_blank"><i class="bi bi-youtube"></i></a>
        </div>
      </div>

      <!-- ðŸŸ© Columna central (evento) -->
      <div class="col-12 col-lg-6 central-col">
        <h2 class="mb-3 text-light fw-bold">{{ event?.name }}</h2>

        <div class="event-image mb-4">
          <img [src]="event?.img" alt="Event Image" class="img-fluid rounded shadow" />
        </div>

        <!-- ðŸŽ  Carrusel del evento -->
        <!-- ðŸŽ  Carrusel del evento (versiÃ³n Bootstrap adaptada) -->
        <div class="carousel slide intro-carousel">
          <div class="carousel-inner">
            <div *ngFor="let image of event?.images; let i = index" class="carousel-item"
              [class.active]="i === currentSlide">
              <img [src]="image.img" class="d-block w-100 carousel-media" [alt]="image.nameempresa" />
            </div>
          </div>

          <button class="carousel-control-prev" type="button" (click)="prevSlide()">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" (click)="nextSlide()">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>




        <!-- ðŸ•“ Placeholder mientras carga -->
        <div *ngIf="!event?.images?.length" class="text-light text-center py-5">
          <div class="spinner-border text-light"></div>
          <p class="mt-3">Cargando imÃ¡genes del evento...</p>
        </div>

        <button class="btn btn-warning fw-bold" (click)="openPlayerModal()">ðŸŽ® Empezar Juego</button>
      </div>

      <!-- ðŸŸ¦ Columna derecha (banner) -->
      <div class="col-12 col-lg-3 mb-4 mb-lg-0 banner-col">

        <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/Chevalier+blanco.png" alt="Logo"
          class="banner-logo mb-3" />


  <!-- ðŸŽ¬ SimulaciÃ³n de carrusel de videos (derecha) -->
  <div class="video-rotator" *ngIf="videoUrlsRight.length > 0">
    <video
      #videoPlayerRight
      [src]="videoUrlsRight[currentVideoRight]"
      autoplay
      muted
      playsinline
      (ended)="nextVideo('right')"
    ></video>
  </div>



        <!-- ðŸ”— Redes -->
        <div class="social-icons mt-3 d-flex justify-content-center gap-3">
          <a href="https://facebook.com" target="_blank"><i class="bi bi-facebook"></i></a>
          <a href="https://instagram.com" target="_blank"><i class="bi bi-instagram"></i></a>
          <a href="https://tiktok.com" target="_blank"><i class="bi bi-tiktok"></i></a>
          <a href="https://youtube.com" target="_blank"><i class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>
  </div>
  }




  <!-- Modal de ingreso jugador -->
  <div class="modal fade" id="playerModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header border-0">
          <h5 class="modal-title">ðŸ‘¤ Ingresa tus datos</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form #playerForm="ngForm">
            <div class="mb-3">
              <label class="form-label">Nombre completo</label>
              <input type="text" class="form-control" [(ngModel)]="playerName" name="name" required />
            </div>
            <div class="mb-3">
              <label class="form-label">CÃ©dula</label>
              <input type="text" class="form-control" [(ngModel)]="playerCedula" name="cedula" required />
            </div>
          </form>
        </div>
        <div class="modal-footer border-0">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-success" (click)="registerPlayer()">Guardar y Jugar</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Tablero del juego -->
  @if (!loading && !error && playerRegistered && gameState.isGameStarted && !gameState.isGameCompleted) {
  <div class="game-board-layout d-flex  ">
    <!-- Header lateral izquierdo -->
    <div class="game-sidebar-left p-3 text-white text-center">
      <div class="sidebar-top">
        <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/logo-teamcellmania.png"
          alt="Logo">
        <h5>{{ event?.name }}</h5>
        <p class="small">{{ event?.location }}</p>
      </div>
      <div class="image-carousel">
        <div class="carousel-track" [style.transform]="'translateY(-' + carouselIndex * 110 + 'px)'">
          <div class="carousel-item" *ngFor="let img of event?.images">
            <img [src]="img.img" [alt]="img.nameempresa">
          </div>
        </div>
      </div>
      <div class="socials">
        <a href="#" target="_blank"><i class="fab fa-tiktok"></i> TikTok</a>
        <a href="#" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
        <a href="#" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
        <a href="#" target="_blank"><i class="fab fa-youtube"></i> YouTube</a>
      </div>
    </div>

    <!-- Tablero central -->
    <div class="game-grid-container container-fluid flex-grow-1 d-flex justify-content-center align-items-center ">
      <div class="cards-grid p-4">
        @for (card of gameState.cards; track card.id) {
        <div class="game-card" [class.flipped]="card.isFlipped || card.isMatched" (click)="onCardClick(card)">
          <div class="card-inner">
            <div class="card-front">
              <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/logo-teamcellmania.png"
                alt="Logo" class="front-logo">
            </div>
            <div class="card-back">
              <img [src]="card.image" [alt]="card.nameempresa" class="card-image" />

            </div>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Score lateral derecho -->
    <div class="game-sidebar-right text-center p-4 bg-white bg-opacity-75">
      <div class="info-item mb-3">
        <div class="info-label">Tiempo</div>
        <div class="info-value text-primary fw-bold">{{ formatTime(timer) }}</div>
      </div>
      <div class="info-item mb-3">
        <div class="info-label">Movimientos</div>
        <div class="info-value text-success fw-bold">{{ gameState.moves }}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Pares</div>
        <div class="info-value text-warning fw-bold">{{ matchedPairs }}/{{ totalPairs }}</div>
      </div>
    </div>
  </div>
  }

  <!-- Pantalla de juego completado -->
  @if (gameState.isGameCompleted) {
  <div class="completion-screen d-flex justify-content-center align-items-center vh-100">
    <div class="card completion-card text-center p-5">
      <i class="fas fa-trophy display-1 text-warning mb-3"></i>
      <h3 class="fw-bold mb-3">Â¡Juego Completado!</h3>
      <div class="mb-4">
        <p><strong>Tiempo:</strong> {{ formatTime(timer) }}</p>
        <p><strong>Movimientos:</strong> {{ gameState.moves }}</p>
        <p><strong>Pares:</strong> {{ matchedPairs }}/{{ totalPairs }}</p>
      </div>
      <div>
        <button class="btn btn-primary me-2" (click)="playAgain()">
          <i class="fas fa-redo me-2"></i> Jugar Otra Vez
        </button>
        <button class="btn btn-warning" (click)="viewRanking()">
          <i class="fas fa-trophy me-2"></i> Ver Ranking
        </button>
      </div>
    </div>
  </div>
  }
</div>