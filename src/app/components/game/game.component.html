<div class="game-container">
  <!-- Si est√° cargando -->
  @if (loading) {
  <div class="loading-screen d-flex justify-content-center align-items-center vh-100">
    <div class="text-center">
      <div class="spinner-border text-light mb-3" role="status"></div>
      <p class="text-white">Cargando evento...</p>
    </div>
  </div>
  }

  <!-- Si hay error -->
  @if (error && !loading) {
  <div class="text-center mt-5">
    <div class="alert alert-danger d-inline-block">
      <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
    </div>
  </div>
  }
  <!-- üé• Pantalla inicial con carrusel -->
  @if (!loading && !error && !playerRegistered && !gameState.isGameStarted) {
  <div class="intro-layout container-fluid py-4 text-center text-light">
    <div class="row align-items-center justify-content-center">

      <!-- üü• Columna izquierda (banner) -->
      <!-- üü• Columna izquierda -->
      <div class="col-12 col-lg-3 mb-4 mb-lg-0 banner-col">
        <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/logo-teamcellmania.png" alt="Logo"
          class="banner-logo mb-3" />

        <!-- üé¨ Carrusel de videos con redes sobrepuestas -->
        <div class="video-rotator" *ngIf="videoUrlsLeft.length > 0">
          <video #videoPlayerLeft [src]="videoUrlsLeft[currentVideoLeft]" autoplay muted playsinline
            (ended)="nextVideo('left')"></video>

          <!-- üåü Redes sociales sobre el video -->
          <div class="social-overlay">
            <div class="social-item"><i class="fab fa-tiktok"></i><span>&#64;teamcellmania_13</span></div>
            <div class="social-item"><i class="fab fa-instagram"></i><span>&#64;teamcellmania</span></div>
            <div class="social-item"><i class="fab fa-facebook"></i><span>TeamCellmania</span></div>
            <div class="social-item"><i class="fab fa-youtube"></i><span>&#64;teamcellmania877</span></div>
          </div>
        </div>
      </div>

      <!-- üü© Columna central (evento) -->
      <div class="col-12 col-lg-6 central-col">
        <h2 class="mb-3 text-light fw-bold">{{ event?.name }}</h2>

        <div class="event-image mb-4">
          <img [src]="event?.img" alt="Event Image" class="img-fluid rounded shadow" />
        </div>

        <!-- üé† Carrusel del evento -->
        <!-- üé† Carrusel del evento (versi√≥n Bootstrap adaptada) -->
        <div class="carousel slide intro-carousel">
  <div class="carousel-inner">
    <div *ngFor="let image of event?.images; let i = index"
         class="carousel-item"
         [class.active]="i === centralSlideIndex">
      <img [src]="image.img"
           class="d-block w-100 carousel-media"
           [alt]="image.nameempresa" />
    </div>
  </div>

 
        </div>




        <!-- üïì Placeholder mientras carga -->
        <div *ngIf="!event?.images?.length" class="text-light text-center py-5">
          <div class="spinner-border text-light"></div>
          <p class="mt-3">Cargando im√°genes del evento...</p>
        </div>

        <button class="btn btn-warning fw-bold" (click)="openPlayerModal()">üéÆ Empezar Juego</button>
      </div>

      <!-- üü¶ Columna derecha (banner) -->
      <div class="col-12 col-lg-3 mb-4 mb-lg-0 banner-col">
        <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/Chevalier+blanco.png" alt="Logo"
          class="banner-logo mb-3" />

        <div class="video-rotator" *ngIf="videoUrlsRight.length > 0">
          <video #videoPlayerRight [src]="videoUrlsRight[currentVideoRight]" autoplay muted playsinline
            (ended)="nextVideo('right')"></video>

          <!-- üåü Redes sociales sobre el video -->
          <div class="social-overlay">
            <div class="social-item"><i class="fab fa-tiktok"></i><span>&#64;chevalierbarber</span></div>
            <div class="social-item"><i class="fab fa-instagram"></i><span>&#64;chevalier_barber</span></div>
            <div class="social-item"><i class="fab fa-facebook"></i><span>Chevalier barber/shop </span></div>
            <div class="social-item"><i class="fab fa-youtube"></i><span>&#64;ChevalierBarberShop</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  }




  <!-- Modal de ingreso jugador -->
<div class="modal fade" id="playerModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white position-relative overflow-hidden">
      <div class="modal-header border-0">
        <h5 class="modal-title">üë§ Ingresa tus datos</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- üåÄ Overlay spinner -->
      <div
        *ngIf="showOverlaySpinner"
        class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center bg-dark bg-opacity-75 z-50"
      >
        <div class="spinner-border text-light mb-3" style="width: 3rem; height: 3rem"></div>
        <div>Procesando jugador...</div>
      </div>

      <!-- ‚úÖ Check de √©xito -->
      <div
        *ngIf="showSuccessCheck"
        class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center bg-dark bg-opacity-75 z-50"
      >
        <i class="bi bi-check-circle text-success" style="font-size: 4rem"></i>
        <div class="mt-2">{{ successMessage }}</div>
      </div>

      <div class="modal-body" [class.opacity-50]="showOverlaySpinner || showSuccessCheck">
        <form #playerForm="ngForm">
          <div class="mb-3 position-relative">
            <label class="form-label">C√©dula</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="playerCedula"
              name="cedula"
              required
              maxlength="10"
              (ngModelChange)="onCedulaChange($event)"
              [disabled]="showOverlaySpinner || showSuccessCheck"
            />
            <div
              *ngIf="isCheckingCedula"
              class="spinner-border spinner-border-sm text-light position-absolute end-0 top-50 translate-middle-y me-3"
            ></div>
            <div *ngIf="cedulaInvalid" class="text-danger mt-1">‚ùå C√©dula inv√°lida</div>
            <div *ngIf="playerExists && !cedulaInvalid" class="text-success mt-1">‚úÖ Jugador encontrado</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Nombre completo</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="playerName"
              name="name"
              required
              [readonly]="playerExists"
              [disabled]="showOverlaySpinner || showSuccessCheck"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Tel√©fono</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="playerTelefono"
              name="telefono"
              required
              maxlength="10"
              (blur)="validatePhone()"
              [disabled]="showOverlaySpinner || showSuccessCheck"
            />
            <div *ngIf="phoneInvalid" class="text-danger mt-1">
              ‚ùå Tel√©fono inv√°lido (debe empezar con 09)
            </div>
          </div>
        </form>

        <div *ngIf="errorMessage" class="text-danger text-center mt-2 fw-bold">
          {{ errorMessage }}
        </div>
      </div>

      <div class="modal-footer border-0">
        <button
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          [disabled]="isRegistering || showOverlaySpinner || showSuccessCheck"
        >
          Cancelar
        </button>

        <button
          class="btn btn-success d-flex align-items-center justify-content-center gap-2"
          (click)="registerPlayer()"
          [disabled]="
            isRegistering ||
            cedulaInvalid ||
            phoneInvalid ||
            !playerCedula ||
            !playerTelefono ||
            !playerName ||
            showOverlaySpinner ||
            showSuccessCheck
          "
        >
          <span>Guardar y Jugar</span>
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- Tablero del juego -->
  @if (!loading && !error && playerRegistered && gameState.isGameStarted && !gameState.isGameCompleted) {
  <div class="game-board-layout">
    <!-- üß≠ Banner Izquierdo -->
    <aside class="sidebar left text-white text-center p-3">
      <img [src]="event?.img" alt="Logo" class="event-logo">
      <h5>{{ event?.name }}</h5>
      <p class="small">{{ event?.location }}</p>

      <div class="vertical-carousel">
        <div class="carousel-track" [style.transform]="'translateY(-' + carouselIndex * 110 + 'px)'">
          <div class="carousel-item" *ngFor="let img of event?.images">
            <img [src]="img.img" [alt]="img.nameempresa" />
          </div>
        </div>
      </div>
    </aside>

    <!-- üéÆ Tablero de juego -->
    <main class="game-grid">
      @for (card of gameState.cards; track card.id) {
      <div class="game-card" [class.flipped]="card.isFlipped || card.isMatched" (click)="onCardClick(card)">
        <div class="card-inner">
          <div class="card-front">
            <img src="https://teamcellmania-public.s3.us-east-1.amazonaws.com/eventologos/logo-teamcellmania.png"
              alt="Logo" class="front-logo">
          </div>
          <div class="card-back">
            <img [src]="card.image" [alt]="card.nameempresa" class="card-image" />
          </div>
        </div>
      </div>
      }
    </main>

    <!-- üìä Banner Derecho -->
    <aside class="sidebar right bg-white bg-opacity-75 text-center p-3">
      <div>
        <p class="info-label">Tiempo</p>
        <p class="info-value text-primary">{{ formatTime(timer) }}</p>
      </div>
      <div>
        <p class="info-label">Movimientos</p>
        <p class="info-value text-success">{{ gameState.moves }}</p>
      </div>
      <div>
        <p class="info-label">Pares</p>
        <p class="info-value text-warning">{{ matchedPairs }}/{{ totalPairs }}</p>
      </div>
    </aside>
  </div>
  }


  <!-- Pantalla de juego completado -->
 @if (gameState.isGameCompleted) {
  <div class="completion-screen d-flex justify-content-center align-items-center vh-100">
    <div class="card completion-card text-center p-5">
      <i class="fas fa-trophy display-1 text-warning mb-3"></i>
      <h3 class="fw-bold mb-3">¬°Juego Completado!</h3>

      <div class="mb-4">
        <p><strong>Tiempo:</strong> {{ formatTime(timer) }}</p>
        <p><strong>Movimientos:</strong> {{ gameState.moves }}</p>
        <p><strong>Pares:</strong> {{ matchedPairs }}/{{ totalPairs }}</p>
        <p><strong>Puntaje:</strong> {{ playerSocre }}</p> <!-- üëà agregado -->
      </div>

      <div>
        <button class="btn btn-primary me-2" (click)="resetToEventLoadState()">
          <i class="fas fa-redo me-2"></i> Aceptar
        </button>
        <button class="btn btn-warning" (click)="viewRanking()">
          <i class="fas fa-trophy me-2"></i> Ver Ranking
        </button>
      </div>
    </div>
  </div>
}








